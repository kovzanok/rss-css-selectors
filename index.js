(()=>{"use strict";function e(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var t="function"==typeof Symbol&&Symbol.observable||"@@observable",n=function(){return Math.random().toString(36).substring(7).split("").join(".")},r={INIT:"@@redux/INIT"+n(),REPLACE:"@@redux/REPLACE"+n(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+n()}};const s=[{searchedEl:"necklace",markup:"\n    <necklace />\n    <necklace />",searchedSelector:"necklace",levelName:"Type Selector"},{searchedEl:"rings",markup:"\n    <ring />\n    <necklace />\n    <ring />",searchedSelector:"ring ",levelName:"Type Selector"},{searchedEl:"empire necklace",markup:'\n    <necklace id="empire"/>\n    <necklace />',searchedSelector:"#empire",levelName:"ID Selector"},{searchedEl:"ruby in necklace",markup:"\n    <ring>\n      <ruby />\n    </ring>\n    <necklace>\n      <ruby />\n    </necklace>\n    <ruby />",searchedSelector:"necklace ruby",levelName:"Descendant Selector"},{searchedEl:"gold necklace",markup:'\n    <necklace />\n    <necklace class="gold"/>\n    <necklace />',searchedSelector:".gold",levelName:"Class Selector"},{searchedEl:"gold ring",markup:'\n    <necklace class="gold" />\n    <ring class="gold" />\n    <necklace class="gold" />',searchedSelector:"ring.gold",levelName:"Type & Class Selector"},{searchedEl:"all rings and necklaces",markup:'\n    <sapphire/>\n    <ring class="gold">\n      <sapphire />\n    </ring>\n    <necklace>\n      <ruby />\n    </necklace>\n    <necklace class="gold" />\n    <sapphire/>',searchedSelector:"ring,necklace",levelName:"Comma Combinator"},{searchedEl:"all the things",markup:'\n    <sapphire />\n    <ring class="gold"/>\n    <ruby />\n    <necklace class="gold"/>\n    ',searchedSelector:"*",levelName:"The Universal Selector"},{searchedEl:"all gems in necklaces",markup:'\n    <sapphire />\n    <necklace>\n      <ruby />\n    </necklace>\n    <necklace class="gold">\n      <sapphire />\n    </necklace>\n    <ruby /> \n    ',searchedSelector:"necklace *",levelName:"Tag & Universal Selector"},{searchedEl:"every ruby that's next to necklace",markup:'\n    <ruby />\n    <necklace>\n      <ruby />\n    </necklace>\n    <ruby />\n    <necklace class="gold">\n      <sapphire />\n    </necklace>\n    <ruby />\n    ',searchedSelector:"necklace + ruby",levelName:"Adjacent Sibling Selector"}],l=Number(window.localStorage.getItem("rss-css-selector-lvl")),a={levelNum:l,levelInfo:s[l]},o=JSON.parse(window.localStorage.getItem("rss-css-selector-progress")||"[]"),c=function n(s,l,a){var o;if("function"==typeof l&&"function"==typeof a||"function"==typeof a&&"function"==typeof arguments[3])throw new Error(e(0));if("function"==typeof l&&void 0===a&&(a=l,l=void 0),void 0!==a){if("function"!=typeof a)throw new Error(e(1));return a(n)(s,l)}if("function"!=typeof s)throw new Error(e(2));var c=s,i=l,u=[],d=u,h=!1;function p(){d===u&&(d=u.slice())}function m(){if(h)throw new Error(e(3));return i}function g(t){if("function"!=typeof t)throw new Error(e(4));if(h)throw new Error(e(5));var n=!0;return p(),d.push(t),function(){if(n){if(h)throw new Error(e(6));n=!1,p();var r=d.indexOf(t);d.splice(r,1),u=null}}}function v(t){if(!function(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(t))throw new Error(e(7));if(void 0===t.type)throw new Error(e(8));if(h)throw new Error(e(9));try{h=!0,i=c(i,t)}finally{h=!1}for(var n=u=d,r=0;r<n.length;r++)(0,n[r])();return t}return v({type:r.INIT}),(o={dispatch:v,subscribe:g,getState:m,replaceReducer:function(t){if("function"!=typeof t)throw new Error(e(10));c=t,v({type:r.REPLACE})}})[t]=function(){var n,r=g;return(n={subscribe:function(t){if("object"!=typeof t||null===t)throw new Error(e(11));function n(){t.next&&t.next(m())}return n(),{unsubscribe:r(n)}}})[t]=function(){return this},n},o}(function(t){for(var n=Object.keys(t),s={},l=0;l<n.length;l++){var a=n[l];"function"==typeof t[a]&&(s[a]=t[a])}var o,c=Object.keys(s);try{!function(t){Object.keys(t).forEach((function(n){var s=t[n];if(void 0===s(void 0,{type:r.INIT}))throw new Error(e(12));if(void 0===s(void 0,{type:r.PROBE_UNKNOWN_ACTION()}))throw new Error(e(13))}))}(s)}catch(e){o=e}return function(t,n){if(void 0===t&&(t={}),o)throw o;for(var r=!1,l={},a=0;a<c.length;a++){var i=c[a],u=s[i],d=t[i],h=u(d,n);if(void 0===h)throw n&&n.type,new Error(e(14));l[i]=h,r=r||h!==d}return(r=r||c.length!==Object.keys(t).length)?l:t}}({level:function(e=a,t){return"currentLevel/changeLevel"===t.type?{levelNum:t.payload,levelInfo:s[t.payload]}:e},progress:function(e=o,t){switch(t.type){case"progress/addLevel":return[...e,t.payload];case"progress/changeLevel":return e.map((e=>e.levelNum===t.payload.levelNum?t.payload:e));case"progress/reset":return[];default:return e}}}));class i{constructor({searchedEl:e,markup:t,searchedSelector:n},r){this.searchedEl=e,this.markup=t,this.searchedSelector=n,this.progress=r}setController(e){this.controller=e}}const u=e=>e.split("\n").map((e=>e.trim())).filter((e=>0!==e.length)),d=e=>{const t=Array.from(e.children),n=[];return t.forEach((e=>{e instanceof HTMLElement&&(n.push(e),0!==e.childElementCount&&n.push(...d(e)))})),n},h=e=>{e.classList.add("shake"),e.onanimationend=()=>{e.classList.remove("shake")}},p=(e,t,n)=>{const r=e.querySelectorAll(t);r.forEach(((e,t)=>{e instanceof HTMLElement&&(e.classList.add("clean"),e.onanimationend=()=>{e.classList.remove("clean"),t===r.length-1&&n()})}))},m=e=>{const t=document.createElement(e.tag);if(e.className&&(t.className=e.className),e.innerHTML&&(t.innerHTML=e.innerHTML),e.disabled&&t.setAttribute("disabled",""),e.attributes)for(const[n,r]of Object.entries(e.attributes))t.setAttribute(n,r);if(e.textContent&&(t.textContent=e.textContent),e.eventHandlers)for(const[n,r]of Object.entries(e.eventHandlers))t.addEventListener(n,r);return t};class g extends i{constructor(){const{levelInfo:e}=c.getState().level,{searchedEl:t,markup:n,searchedSelector:r}=e;super({searchedEl:t,markup:n,searchedSelector:r})}renderBoardElements(){const e=m({tag:"div",className:"board"});if(this.searchedEl){const t=m({tag:"h1",className:"board__title",textContent:`Select the ${this.searchedEl}`});this.gameField=this.renderGame();const n=m({tag:"button",className:"board__help",textContent:"Got stuck? Click me!",eventHandlers:{click:this.controller.handleHelp}});e.append(t,n,this.gameField,g.helperElement)}return e}renderGame(){const e=m({tag:"div",className:"parent board__field",eventHandlers:{mouseover:this.controller.handleHover,mouseout:this.controller.handleHover}});return this.markup&&((e,t)=>{let n="",r=!1;e.forEach((e=>{if(r){if(e.includes("/>"))return void(n+=e);if(e.includes("</"))return r=!1,n+=e,void(t.innerHTML+=n)}e.includes("</")||e.includes("/>")?(n=e,t.innerHTML+=n):(r=!0,n=e)}))})(u(this.markup),e),this.searchedSelector&&e.querySelectorAll(this.searchedSelector).forEach((e=>e.classList.add("pulsate"))),e}getGameField(){return this.gameField}}g.helperElement=m({tag:"div",className:"board__helper"});const v=g;class f extends i{constructor(){const{levelInfo:e}=c.getState().level,{searchedSelector:t}=e;super({searchedSelector:t})}renderInputForm(){const e=m({tag:"div",className:"css-form__wrapper"}),t=m({tag:"form",className:"css-form blink",eventHandlers:{submit:this.controller.handleSubmit}}),n=m({tag:"input",attributes:{placeholder:"Type your selector"},className:"css-input",eventHandlers:{input:this.controller.handleInput}});n.autofocus=!0;const r=m({tag:"button",className:"css-submit",textContent:"Enter"});return this.form=t,t.append(n,r),e.append(t),e}getForm(){return this.form}}class y extends i{constructor(){const{levelInfo:e}=c.getState().level,{markup:t}=e;super({markup:t})}renderTextWrapperElement(e){return m({tag:"div",textContent:e})}renderMarkup(){const e=m({tag:"div",className:"parent markup",textContent:'<div class="enchanting-table">',eventHandlers:{mouseover:this.controller.handleHover,mouseout:this.controller.handleHover}});if(this.markup){const t=u(this.markup);this.markup.includes("</")?e.append(...((e,t)=>{const n=[];let r,s=!1;return e.forEach((e=>{if(s){if(e.includes("/>"))return void r.append(t(e));if(e.includes("</"))return s=!1,r.append(e),void n.push(r)}e.includes("</")||e.includes("/>")?(r=t(e),n.push(r)):(s=!0,r=t(e))})),n})(t,this.renderTextWrapperElement.bind(this))):t.forEach((t=>{e.append(this.renderTextWrapperElement(t))})),e.append("</div>")}return this.markupElement=e,e}getMarkupElement(){return this.markupElement}}class k{constructor(e,t,n,r,s){this.gameBoard=e,this.htmlMarkup=t,this.cssInput=n,this.app=r,this.popup=s,this.nextLevel=()=>{const{levelNum:e}=c.getState().level;c.dispatch({type:"currentLevel/changeLevel",payload:e+1}),this.app.restart()},this.toggleMenu=e=>{const t=e.target;t instanceof HTMLElement&&("burger"===t.id?(t.parentElement.querySelector("#menu").classList.toggle("active"),document.body.classList.toggle("lock")):(t.classList.contains("level-item")||t.classList.contains("menu")||t.classList.contains("reset-button"))&&(document.getElementById("menu").classList.remove("active"),document.body.classList.remove("lock")))}}static separateElementAndMarkup(e,t){var n;return 0===(null===(n=t.textContent)||void 0===n?void 0:n.length)?[t,e]:[e,t]}static displayHelper(e){const t=e.getBoundingClientRect();v.helperElement.style.display="block",v.helperElement.style.left=t.left+20+"px",v.helperElement.style.top=t.top-60+"px"}static hideHepler(){v.helperElement.style.display="none"}static getElementMarkup(e){const t=e.textContent,n=t.indexOf("<"),r=t.indexOf(">"),s=t.slice(n+1,r).replace("/","").trim(),l=s.includes(" "),a=s.slice(0,l?s.indexOf(" "):s.length);return`<${s}></${a}>`}static hightlightElements(e,t){e.classList.add("highlighten"),t.classList.add("highlighten")}static removeHightlight(e,t){e.classList.remove("highlighten"),t.classList.remove("highlighten")}findHoveredRelative(e,t){const n=d(e),r=(s=t,n.findIndex((e=>e===s)));var s;const l=e.classList.contains("markup")?this.gameBoard.getGameField():this.htmlMarkup.getMarkupElement();return d(l)[r]}checkAnswer(e){if(0===e.length)return!1;const t=this.gameBoard.getGameField(),n=t.querySelectorAll(e),r=t.querySelectorAll(this.cssInput.searchedSelector);return Array.from(r).every(((e,t)=>e===n[t]))&&n.length===r.length}handleWrongAnswer(e){const t=this.gameBoard.getGameField();0!==e.length&&t.querySelectorAll(e).forEach((e=>{e instanceof HTMLElement&&h(e)}));const n=this.cssInput.getForm(),r=this.htmlMarkup.getMarkupElement();h(n),h(r)}findFirstNotcompletedLevel(){const e=c.getState().progress.map((e=>e.levelNum)).sort(((e,t)=>e-t));return new Array(s.length).fill(0).map(((e,t)=>t)).filter(((t,n)=>t!==e[n]))[0]}removeGameField(){const e=this.gameBoard.getGameField(),{levelNum:t}=c.getState().level;switch(!0){case k.isWin()&&!k.wasVictoryShown:p(e,this.cssInput.searchedSelector,(()=>{this.popupElement=this.popup.renderPopup(),document.body.append(this.popupElement),k.wasVictoryShown=!0,this.goToLevel(t)}).bind(this));break;case k.isLastLevel():{const t=this.findFirstNotcompletedLevel();p(e,this.cssInput.searchedSelector,(()=>this.goToLevel(t)).bind(this));break}default:p(e,this.cssInput.searchedSelector,this.nextLevel.bind(this))}}goToLevel(e){c.dispatch({type:"currentLevel/changeLevel",payload:e}),this.app.restart()}enterCorrenctAnswer(){const e=this.cssInput.getForm().querySelector("input");e.value="",this.fillInputValue(e,0,this.cssInput.searchedSelector),this.saveProgress({wasHelpUsed:!0})}fillInputValue(e,t,n){const r=new Event("input");e.dispatchEvent(r),t<n.length&&(e.value+=n[t++],setTimeout((()=>this.fillInputValue(e,t,n)),200))}saveProgress({isDone:e=!1,wasHelpUsed:t=!1}){const n=c.getState().progress,{levelNum:r}=c.getState().level,s=Object.assign({},n.find((e=>e.levelNum===r)));3===Object.keys(s).length?(e&&(s.isDone=e),t&&(s.wasHelpUsed=t),c.dispatch({type:"progress/changeLevel",payload:s})):c.dispatch({type:"progress/addLevel",payload:{levelNum:r,isDone:e,wasHelpUsed:t}})}resetProgress(){c.dispatch({type:"currentLevel/changeLevel",payload:0}),c.dispatch({type:"progress/reset",payload:{levelNum:0,wasHelpUsed:!1,isDone:!1}}),k.wasVictoryShown=!1,this.app.restart()}static isLastLevel(){const{levelNum:e}=c.getState().level;return e===s.length-1}static isWin(){return c.getState().progress.length===s.length}static changeClassName(e){const t=e.form;0===e.value.length?t.classList.add("blink"):t.classList.remove("blink")}closePopup(){this.popupElement.remove()}}k.wasVictoryShown=!1;const E=k;class b{constructor(){this.handleHover=e=>{const t=e.target;if(!(t instanceof HTMLElement))return;const n=t.closest(".parent");if(!(n instanceof HTMLElement)||t.classList.contains("parent"))return;const r=this.model.findHoveredRelative(n,t),[s,l]=E.separateElementAndMarkup(r,t),a=E.getElementMarkup(l);v.helperElement.textContent=a,"mouseover"===e.type&&(E.hightlightElements(r,t),E.displayHelper(s)),"mouseout"===e.type&&(E.hideHepler(),E.removeHightlight(r,t))},this.handleSubmit=e=>{e.preventDefault();const t=e.target;if(!(t instanceof HTMLFormElement))return;const n=t.querySelector("input");n&&(this.model.checkAnswer(n.value)?(this.model.saveProgress({isDone:!0}),this.model.removeGameField()):this.model.handleWrongAnswer(n.value))},this.handleGoToLevel=e=>{const t=e.target;t instanceof HTMLLIElement&&this.model.goToLevel(Number(t.id))},this.handleReset=()=>{this.model.resetProgress()},this.handleHelp=()=>{this.model.enterCorrenctAnswer()},this.handleMainuClick=e=>{this.model.toggleMenu(e)},this.handleInput=e=>{const t=e.target;t instanceof HTMLInputElement&&E.changeClassName(t)},this.handlePopupClose=()=>{this.model.closePopup()}}setModel(e){this.model=e}}class N extends i{constructor(){const{levelNum:e}=c.getState().level;super({},c.getState().progress),this.levelNum=e}renderNavigation(){const e=m({tag:"div",className:"navigation"}),t=m({tag:"h2",textContent:"Levels",className:"nav-title"}),n=this.renderLevelList(),r=m({tag:"button",className:"reset-button",textContent:"Reset progress",eventHandlers:{click:this.controller.handleReset}});return e.append(t,n,r),e}renderLevelList(){const e=m({tag:"ol",className:"level-list",eventHandlers:{click:this.controller.handleGoToLevel}}),t=s.map(((e,t)=>{const n=[this.progress.find((e=>e.levelNum===t&&e.isDone))?"done":"",this.progress.find((e=>e.levelNum===t&&e.wasHelpUsed))?"help":"",this.levelNum===t?"current-level":"","level-item"];return m({tag:"li",className:n.join(" ").trim(),textContent:e.levelName,attributes:{id:String(t)}})}));return e.append(...t),e}}class S extends i{constructor(){super({})}renderPopup(){const e=m({tag:"div",className:"popup"}),t=m({tag:"div",className:"popup__body",textContent:"Victory!"}),n=m({tag:"button",className:"popup__button",textContent:"Back to game",eventHandlers:{click:this.controller.handlePopupClose}});return t.append(n),e.append(t),e}}class L{constructor(){this.gameContainer=document.querySelector(".game-container"),this.menuContainer=document.querySelector(".menu-container"),window.onunload=()=>{const{level:e,progress:t}=c.getState();localStorage.setItem("rss-css-selector-lvl",String(e.levelNum)),localStorage.setItem("rss-css-selector-progress",JSON.stringify(t))}}start(){const e=document.querySelector(".main"),t=new v,n=new f,r=new y,s=new N,l=new S,a=new E(t,r,n,this,l),o=new b;o.setModel(a),L.setControllers([t,s,r,n,l],o),e.onclick=o.handleMainuClick,this.gameContainer.append(t.renderBoardElements(),n.renderInputForm(),r.renderMarkup()),this.menuContainer.append(s.renderNavigation())}restart(){this.gameContainer.innerHTML="",this.menuContainer.innerHTML="",this.start()}static setControllers(e,t){e.forEach((e=>e.setController(t)))}}(new L).start()})();